@model IEnumerable<Tienda.Models.Producto>

@{
    ViewData["Title"] = "Inicio";
}
<head>
<h1 class="text-center mb-5">Productos disponibles</h1>
</head>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Imagen</th>
            <th>Acción</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Nombre)</td>
                <td>@Html.DisplayFor(modelItem => item.Descripcion)</td>
                <td>$@Html.DisplayFor(modelItem => item.Precio)</td>
                <td>@Html.DisplayFor(modelItem => item.Stock)</td>
                <td>
                    <img src="@item.Imagen" alt="Imagen de @item.Nombre" style="max-width:100px; height:auto;" />
                </td>
                <td>
                    <button class="btn btn-success add-to-cart"
                            data-name="@item.Nombre"
                            data-price="@item.Precio">
                        ¡Agregar al carrito!
                    </button>
                </td>
            </tr>
        }
    </tbody>
</table>

<h3>Carrito</h3>
<ul id="cart-items"></ul>
<p>Total: $<span id="cart-total">0</span></p>
<button id="checkout" class="btn btn-primary">¡Finalizar pedido por WhatsApp!</button>

<script>
    let cart = [];

    function renderCart() {
        const cartItems = document.getElementById('cart-items');
        const cartTotal = document.getElementById('cart-total');
        cartItems.innerHTML = '';
        let total = 0;
        cart.forEach(item => {
            cartItems.innerHTML += `<li>${item.name} - $${item.price}</li>`;
            total += parseFloat(item.price);
        });
        cartTotal.innerText = total.toFixed(2);
    }

    document.querySelectorAll('.add-to-cart').forEach(btn => {
        btn.addEventListener('click', () => {
            const product = {
                name: btn.dataset.name,
                price: btn.dataset.price
            };
            cart.push(product);
            renderCart();
        });
    });

    document.getElementById('checkout').addEventListener('click', () => {
        if(cart.length === 0) { alert("El carrito está vacío"); return; }
        let message = "¡Nuevo pedido!%0A";
        cart.forEach(item => { message += `${item.name} - $${item.price}%0A`; });
        const whatsappNumber = "1131483266"; // reemplaza con tu número
        window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
    });
</script>
